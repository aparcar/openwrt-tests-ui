<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>OpenWrt Test Dashboard - Version Overview</title>

        <!-- Bootstrap CSS -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <!-- Bootstrap Icons -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
        />

        <script src="js/utils.js"></script>

        <style>
            :root {
                --primary-gradient: linear-gradient(
                    135deg,
                    #667eea 0%,
                    #764ba2 100%
                );
                --success-gradient: linear-gradient(
                    135deg,
                    #84fab0 0%,
                    #8fd3f4 100%
                );
                --warning-gradient: linear-gradient(
                    135deg,
                    #fa709a 0%,
                    #fee140 100%
                );
                --danger-gradient: linear-gradient(
                    135deg,
                    #f093fb 0%,
                    #f5576c 100%
                );
            }

            body {
                background-color: #f8f9fa;
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    Oxygen, Ubuntu, Cantarell, sans-serif;
            }

            .navbar {
                background: var(--primary-gradient);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .navbar a {
                color: rgba(255, 255, 255, 0.9);
                text-decoration: none;
                transition: color 0.2s ease;
            }

            .navbar a:hover {
                color: white;
                text-decoration: none;
            }

            .navbar .text-white-50 {
                color: rgba(255, 255, 255, 0.7) !important;
            }

            .version-card {
                background: white;
                border: 1px solid #e9ecef;
                border-radius: 12px;
                padding: 24px;
                transition: all 0.3s ease;
                text-decoration: none;
                color: inherit;
                display: block;
                height: 100%;
            }

            .version-card:hover {
                transform: translateY(-4px);
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
                text-decoration: none;
                color: inherit;
            }

            .version-icon {
                width: 60px;
                height: 60px;
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-bottom: 16px;
                font-size: 24px;
                color: white;
            }

            .version-icon.snapshot {
                background: var(--warning-gradient);
            }

            .version-icon.stable {
                background: var(--success-gradient);
            }

            .version-icon.oldstable {
                background: var(--primary-gradient);
            }

            .version-title {
                font-size: 1.25rem;
                font-weight: 600;
                margin-bottom: 8px;
                color: #212529;
            }

            .version-description {
                color: #6c757d;
                margin-bottom: 0;
                line-height: 1.5;
            }

            .loading-spinner {
                border: 4px solid #f3f4f6;
                border-top: 4px solid #667eea;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                animation: spin 1s linear infinite;
                margin: 0 auto;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            .hero-section {
                background: var(--primary-gradient);
                color: white;
                padding: 4rem 0;
                margin-bottom: 3rem;
            }

            .hero-title {
                font-size: 3rem;
                font-weight: 700;
                margin-bottom: 1rem;
            }

            .hero-subtitle {
                font-size: 1.25rem;
                opacity: 0.9;
                margin-bottom: 0;
            }

            @media (max-width: 768px) {
                .hero-title {
                    font-size: 2rem;
                }
                .hero-subtitle {
                    font-size: 1rem;
                }
            }
        </style>
    </head>

    <body>
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg">
            <div class="container">
                <a class="navbar-brand fw-bold" href="overview.html">
                    <i class="bi bi-router-fill me-2"></i>
                    OpenWrt Test Dashboard
                </a>
                <div class="navbar-nav ms-auto">
                    <span class="navbar-text text-white-50">
                        Select a version to view test results
                    </span>
                </div>
            </div>
        </nav>

        <!-- Hero Section -->
        <div class="hero-section">
            <div class="container text-center">
                <h1 class="hero-title">OpenWrt Test Dashboard</h1>
                <p class="hero-subtitle">
                    Monitor automated testing results across different OpenWrt
                    versions
                </p>
            </div>
        </div>

        <!-- Main Container -->
        <div class="container">
            <!-- Version Selection -->
            <div class="row mb-5">
                <div class="col-12">
                    <h2 class="text-center mb-4">Select Version</h2>
                    <p class="text-center text-muted mb-4">
                        Choose a version to view detailed test results and
                        device status
                    </p>
                </div>
            </div>

            <!-- Versions Container -->
            <div id="versions-container">
                <div class="text-center py-5">
                    <div class="loading-spinner"></div>
                    <p class="mt-3 text-muted">Loading versions...</p>
                </div>
            </div>

            <!-- Error Container -->
            <div id="error-container"></div>
        </div>

        <!-- Footer -->
        <footer class="mt-5 py-4 bg-light">
            <div class="container text-center">
                <p class="text-muted mb-0">
                    <small>
                        Data provided by
                        <a
                            href="https://aparcar.org/openwrt-tests"
                            target="_blank"
                            class="text-decoration-none"
                        >
                            aparcar.org/openwrt-tests
                        </a>
                    </small>
                </p>
            </div>
        </footer>

        <!-- Bootstrap JS Bundle -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <script>
            // Load versions on page load
            document.addEventListener("DOMContentLoaded", function () {
                loadVersions();
            });

            async function loadVersions() {
                try {
                    // Clear error messages
                    document.getElementById("error-container").innerHTML = "";

                    // Load versions.json
                    const response = await fetch(
                        `${CONFIG.BASE_URL}/versions.json`,
                    );
                    if (!response.ok) {
                        throw new Error(
                            `Failed to load versions.json: ${response.status} ${response.statusText}`,
                        );
                    }

                    const versionsData = await response.json();
                    renderVersions(versionsData.versions);
                } catch (error) {
                    console.error("Error loading versions:", error);
                    showError(`Failed to load version data: ${error.message}`);
                }
            }

            function renderVersions(versions) {
                const container = document.getElementById("versions-container");

                if (!versions || versions.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-5">
                            <i class="bi bi-inbox fs-1 text-muted"></i>
                            <p class="mt-2 text-muted">No versions available</p>
                        </div>
                    `;
                    return;
                }

                const versionsHtml = versions
                    .map((version) => {
                        const statusBadge = getVersionStatus(version.name);
                        return `
                        <div class="col-md-4 mb-4">
                            <a href="${version.path}" class="version-card">
                                <h3 class="version-title">${version.title}</h3>
                                <p class="version-description">${version.description}</p>
                                ${statusBadge}
                            </a>
                        </div>
                    `;
                    })
                    .join("");

                container.innerHTML = `
                    <div class="row justify-content-center">
                        ${versionsHtml}
                    </div>
                `;
            }

            function getVersionIcon(versionName) {
                switch (versionName) {
                    case "snapshot":
                        return "bi-lightning-charge-fill";
                    case "stable":
                        return "bi-shield-check-fill";
                    case "oldstable":
                        return "bi-archive-fill";
                    default:
                        return "bi-gear-fill";
                }
            }

            function getVersionStatus(versionName) {
                const statusMap = {
                    snapshot:
                        '<small class="badge bg-warning text-dark mt-2">Development</small>',
                    stable: '<small class="badge bg-success mt-2">Recommended</small>',
                    oldstable:
                        '<small class="badge bg-secondary mt-2">Legacy</small>',
                };
                return statusMap[versionName] || "";
            }

            function showError(message) {
                document.getElementById("error-container").innerHTML = `
                    <div class="alert alert-danger" role="alert">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        ${message}
                    </div>
                `;

                document.getElementById("versions-container").innerHTML = "";
            }
        </script>
    </body>
</html>
